{% extends "base.html" %}
{% block title %}Calendar{% endblock %}
{% block content %}
<h2>캘린더</h2>

<h3>연차 신청 방법: 날짜 클릭 후 사유 입력</h3>
<p>올해 사용한 연차 수: {{ 24 - current_user.calculate_days_off() }} days</p>
<p>사용 가능한 연차 수: {{ current_user.calculate_days_off() }} days</p>

<!-- Include FullCalendar library -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.7.2/main.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.7.2/main.min.js"></script>

<div id='calendar'></div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');
    var leaves = [
        // Add leave events for the current user
        {% for leave in leaves %}
        {
            title: '{{ leave.reason }}',
            start: '{{ leave.start_date }}',
            end: '{{ leave.end_date + timedelta(days=1) }}',
            color: '{% if leave.status == "Approved" %}green{% elif leave.status == "Rejected" %}red{% else %}yellow{% endif %}',
            allDay: true
        },
        {% endfor %}
    ];
    var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        events: leaves,
        dateClick: function(info) {
            var leaveRequestUrl = "{{ url_for('request_leave') }}";
            var reason = prompt("다음 날짜로 연차를 신청하시겠습니까?" + info.dateStr + "맞다면 사유를 입력하세요.");
            if (reason) {
                window.location.href = leaveRequestUrl + "?date=" + info.dateStr + "&reason=" + encodeURIComponent(reason);
            }
        }
    });
    calendar.render();
});
</script>

<a href="{{ url_for('mypage') }}">Back to My Page</a>
{% endblock %}

